# Шаг 5.2: Поиск и фильтрация

## Описание
Реализация поиска ресторанов по различным критериям: название, блюда из меню, акции, тематические вечера, геолокация.

## Задачи

### 1. API поиска ресторанов
- **GET** `/client-api/r/search`
- Query параметры:
  - `q` - поисковый запрос (название ресторана)
  - `menu_item` - поиск по названию блюда (menu_item)
  - `promotion` - поиск по промо-событиям (акции, тематические вечера, новинки)
  - `promotion_type` - фильтр по типу промо-события (опционально)
  - `isOutdoor` - boolean (опционально) - фильтр по залам на открытом воздухе (true = только рестораны с залами на открытом воздухе)
  - `isSmoking` - boolean (опционально) - фильтр по курящим залам (true = только рестораны с курящими залами)
  - `lat` - широта для поиска по карте
  - `lng` - долгота для поиска по карте
  - `radius` - радиус поиска в км (для геолокации)
  - `limit` - количество результатов
  - `offset` - пагинация

### 2. Поиск по названию ресторана
- Full-text search по названию
- Case-insensitive поиск
- Частичное совпадение (LIKE или полнотекстовый поиск PostgreSQL)
- Сортировка по релевантности

### 3. Поиск по блюдам из меню
- Поиск ресторанов, которые имеют блюдо с указанным названием
- Full-text search по названию блюда
- Возвращает ресторан и информацию о найденном блюде
- Поддержка поиска по описанию блюда (опционально)

### 4. Поиск по промо-событиям (promotions)
- Поиск ресторанов с активными промо-событиями (акции, тематические вечера, новинки)
- Фильтрация по названию промо-события
- Фильтрация по типу промо-события (через promotion_type)
- Возвращает ресторан и информацию о промо-событии
- Только активные промо-события (по датам)
- Поддержка разных типов: акции, тематические вечера, новинки

### 5. Поиск по карте (геолокация)
- Расчет расстояния от точки до ресторана (Haversine formula)
- Фильтрация ресторанов в указанном радиусе
- Сортировка по расстоянию
- Возврат расстояния в результатах

### 6. Фильтр по характеристикам залов
- **Фильтр по залам на открытом воздухе (`isOutdoor`):**
  - Если `isOutdoor=true`: возвращать только рестораны, у которых есть хотя бы один активный зал с `is_outdoor = true`
  - SQL: `EXISTS (SELECT 1 FROM rooms r JOIN floors f ON r.floor_id = f.id WHERE f.restaurant_id = restaurants.id AND r.is_outdoor = true AND r.is_active = true)`
- **Фильтр по курящим залам (`isSmoking`):**
  - Если `isSmoking=true`: возвращать только рестораны, у которых есть хотя бы один активный зал с `is_smoking = true`
  - SQL: `EXISTS (SELECT 1 FROM rooms r JOIN floors f ON r.floor_id = f.id WHERE f.restaurant_id = restaurants.id AND r.is_smoking = true AND r.is_active = true)`
- Оба фильтра можно комбинировать (AND логика)
- Если фильтр не указан, он не применяется

### 7. Комбинированный поиск
- Возможность комбинации нескольких фильтров
- Логика AND для комбинации фильтров
- Приоритет результатов

### 8. Оптимизация поиска
- Индексы в БД для полей поиска
- Полнотекстовый поиск PostgreSQL (опционально)
- Кеширование популярных запросов (опционально)

### 9. Формат ответа
- Единый формат ответа для всех типов поиска
- Информация о типе совпадения (название, блюдо, промо-событие и т.д.)
- Метаданные (общее количество результатов, страницы)

