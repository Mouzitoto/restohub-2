# Шаг 4.7: Столы

## Описание
Интерфейс для управления столами и загрузка фото столов.

## Задачи

### 1. Страница управления столами

#### 1.1. Компонент TablesPage
**Маршрут:** `/tables` (защищенный)

**Структура:**
- Заголовок: "Столы"
- Список столов
- Фильтры: этаж, зал

#### 1.2. Список столов
**Отображение:**
- Таблица с колонками:
  - Номер стола
  - Зал
  - Этаж
  - Количество мест
  - Описание (отображается, если указано, сокращенное до 100 символов)
  - Депозит (отображается, если указан `depositAmount`, например "5000 руб.")
  - Фото через компонент `ImagePreview` с `imageId={table.imageId}`
  - Действия

**Фильтрация:**
- По этажу (dropdown)
- По залу (dropdown, зависит от этажа)
- По количеству мест (min/max)

**Логика:**
- GET запрос на `/admin-api/r/:id/table` с фильтрами

#### 1.3. Форма создания/редактирования
**Модальное окно:** TableFormModal

**Поля:**
```typescript
interface TableForm {
  tableNumber: string;        // required, max 50
  roomId: number;             // required
  capacity: number;            // required, 1-100
  description: string;         // optional, max 10000
  imageId: number | null;     // optional
  depositAmount: string | null; // optional, текст с минимальной суммой депозита
  depositNote: string | null;   // optional, примечание о депозите
}
```

**Секции:**
- Основная информация (номер, зал, количество мест)
- Описание (textarea, опционально)
- Депозит:
  - Минимальная сумма депозита (текстовое поле, опционально)
  - Примечание о депозите (текстовое поле, опционально, например "только на напитки")
- Фото стола (ImageUpload)

**Валидация:**
- `tableNumber`: обязательное, max 50, уникальность в зале
- `roomId`: обязательное
- `capacity`: обязательное, 1-100
- `description`: опциональное, max 10000
- `depositAmount`: опциональное, текстовое поле
- `depositNote`: опциональное, текстовое поле

**Примечание о карте расположения столов:**
- Схема расположения столов - это изображение плана зала, которое загружается администратором через форму редактирования зала (см. шаг 4.6)
- План зала рисуется дизайнером за рамками системы и загружается как изображение
- На плане должны быть нарисованы столы с номерами
- Номера столов в БД (`tableNumber`) должны совпадать с номерами на плане
- Просмотр карты доступен клиентам на странице выбора столов (см. шаг 6.3)

#### 1.4. Загрузка фото столов
**Компонент:** `ImageUpload` (общий компонент, см. раздел 6.2 в шаге 4.1)

**Использование:**
```typescript
<ImageUpload
  currentImageId={formData.imageId}
  onImageUploaded={(imageId) => setFormData({ ...formData, imageId })}
  onImageRemoved={() => setFormData({ ...formData, imageId: null })}
  type="table"
  recommendedSize="800x600px - 1200x900px"
  maxSize={5 * 1024 * 1024} // 5MB
/>
```

**Особенности:**
- Рекомендуемые размеры: 800x600px
- Одно изображение на стол

#### 1.6. Удаление стола
**Процесс:**
1. Модальное окно подтверждения удаления
2. DELETE запрос на `/admin-api/r/:id/table/:tableId`
3. Обработка ответа:
   - **Успех (204 No Content)**: стол успешно удален, обновить список столов
   - **Ошибка (400 Bad Request)**: если в ответе есть сообщение об активных бронированиях, показать пользователю ошибку:
     - Текст ошибки: "Нельзя удалить стол: у стола есть активные бронирования"
     - Отобразить в виде toast notification или модального окна с ошибкой
   - **Ошибка (404 Not Found)**: стол не найден, показать соответствующее сообщение
   - **Ошибка (403 Forbidden)**: нет доступа, показать сообщение об отсутствии прав

### 2. Интеграция с API
- `GET /admin-api/r/:id/table` - список столов
- `POST /admin-api/r/:id/table` - создание
- `GET /admin-api/r/:id/table/:tableId` - получение
- `PUT /admin-api/r/:id/table/:tableId` - обновление
- `DELETE /admin-api/r/:id/table/:tableId` - удаление
- `GET /admin-api/r/:id/room` - список залов для фильтра
- `GET /admin-api/r/:id/room/:roomId` - получение зала с планом
- `POST /admin-api/image` - загрузка фото

## Результаты выполнения шага

По итогу выполнения этого шага должны быть созданы следующие артефакты и выполнены следующие проверки:

### Созданные компоненты:
1. ✅ Страница столов:
   - Список столов с фильтрацией
   - Форма создания/редактирования

2. ✅ Интеграция с API:
   - Запросы к `/admin-api/r/:id/table`
   - Запросы к `/admin-api/image` для загрузки фото
   - Обработка ответов
   - Обработка ошибок

### Функциональные проверки:
1. ✅ CRUD операции работают:
   - Создание стола
   - Редактирование стола
   - Удаление стола


2. ✅ Загрузка фото работает:
   - Фото загружаются через `/admin-api/image`
   - Компонент `ImagePreview` отображает превью корректно
   - При клике на превью открывается модальное окно с оригинальным изображением

### Критерии готовности:
- ✅ Все компоненты созданы и работают
- ✅ Интеграция с API работает
- ✅ Загрузка фото работает
- ✅ Все функциональные проверки пройдены успешно

**Шаг считается выполненным**, когда все компоненты работают и все функциональные проверки пройдены успешно.

