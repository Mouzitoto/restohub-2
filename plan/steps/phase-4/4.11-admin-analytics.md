# Шаг 4.11: Аналитика

## Описание
Интерфейс для просмотра статистики: графики бронирований, статистика предзаказов, экспорт данных.

## Задачи

### 1. Страница аналитики

#### 1.1. Компонент AnalyticsPage
**Маршрут:** `/analytics` (защищенный)

**Структура:**
- Заголовок: "Аналитика"
- Панель фильтров:
  - Период (быстрый выбор: сегодня, неделя, месяц, квартал, год)
  - Custom range (dateFrom, dateTo)
- Табы:
  - "Общая статистика"
  - "Бронирования"
  - "Предзаказы"
  - "Клиенты"
- Кнопка "Экспорт"

#### 1.2. Общая статистика
**Компонент:** OverviewTab

**Карточки метрик:**
- Бронирования (общее, подтвержденных, конверсия)
- Предзаказы (общее, выручка, средний чек)
- Клиенты (всего, новых, постоянных)
- Популярные блюда (топ 5)
- Популярные столы (топ 5)

**Логика:**
- GET запрос на `/admin-api/r/:id/analytics/overview?dateFrom=...&dateTo=...`

#### 1.3. Статистика бронирований
**Компонент:** BookingsAnalyticsTab

**Графики:**
1. **График бронирований по периодам:**
   - Библиотека: Recharts или Chart.js
   - Тип: Line chart или Bar chart
   - Данные: из `/admin-api/r/:id/analytics/booking?groupBy=day`
   - Ось X: даты
   - Ось Y: количество
   - Легенда: статусы

2. **Популярные столы:**
   - Тип: Bar chart или Pie chart
   - Данные: из `popularTables` в ответе API

**Таблицы:**
- Последние бронирования (топ 10)
- Статистика по статусам

#### 1.4. Статистика предзаказов
**Компонент:** PreOrdersAnalyticsTab

**Графики:**
1. **Топ популярных блюд:**
   - Тип: Bar chart (горизонтальный)
   - Данные: из `/admin-api/r/:id/analytics/pre-order`
   - Ось X: количество заказов
   - Ось Y: названия блюд

2. **График предзаказов по дням:**
   - Тип: Line chart
   - Данные: из API с `groupBy=day`

**Таблицы:**
- Последние предзаказы (топ 10)
- Статистика по статусам

#### 1.5. Статистика клиентов
**Компонент:** ClientsAnalyticsTab

**Метрики:**
- Общее количество клиентов
- Новые клиенты за период
- Постоянные клиенты
- Средние показатели

**Топ клиентов:**
- Таблица с топ 10 клиентов
- Данные: из `/admin-api/r/:id/analytics/client`

#### 1.6. Экспорт данных
**Компонент:** ExportButton

**Логика:**
1. При клике:
   - Показать модальное окно:
     - Выбор типа данных (бронирования, предзаказы, клиенты)
     - Выбор формата (CSV, XLSX, JSON)
     - Период (использовать текущие фильтры)
2. При подтверждении:
   - GET запрос на `/admin-api/r/:id/analytics/export?type=...&format=...&dateFrom=...&dateTo=...`
   - Скачать файл с правильным именем

### 2. Библиотеки для графиков
**Рекомендация:** Recharts (React) или Chart.js

**Требования:**
- Responsive дизайн
- Tooltips при наведении
- Zoom (опционально)
- Экспорт графика в изображение (опционально)

### 3. Интеграция с API
- `GET /admin-api/r/:id/analytics/overview` - общая статистика
- `GET /admin-api/r/:id/analytics/booking` - статистика бронирований
- `GET /admin-api/r/:id/analytics/pre-order` - статистика предзаказов
- `GET /admin-api/r/:id/analytics/client` - статистика клиентов
- `GET /admin-api/r/:id/analytics/export` - экспорт данных

## Результаты выполнения шага

По итогу выполнения этого шага должны быть созданы следующие артефакты и выполнены следующие проверки:

### Созданные компоненты:
1. ✅ Страница аналитики:
   - Графики бронирований
   - Графики предзаказов
   - Статистика клиентов
   - Dashboard виджеты

2. ✅ Интеграция с API:
   - Запросы к `/admin-api/r/:id/analytics/*`
   - Обработка данных
   - Обработка ошибок

3. ✅ Экспорт данных:
   - Экспорт в CSV
   - Экспорт в Excel
   - Экспорт в PDF (если реализовано)

### Функциональные проверки:
1. ✅ Графики работают:
   - Данные отображаются корректно
   - Фильтрация работает
   - Интерактивность работает

2. ✅ Экспорт работает:
   - Файлы генерируются корректно
   - Форматы работают

3. ✅ Dashboard работает:
   - Виджеты отображаются корректно
   - Данные обновляются

### Критерии готовности:
- ✅ Все компоненты созданы и работают
- ✅ Интеграция с API работает
- ✅ Графики работают корректно
- ✅ Экспорт данных работает
- ✅ Все функциональные проверки пройдены успешно

**Шаг считается выполненным**, когда все компоненты работают и все функциональные проверки пройдены успешно.

