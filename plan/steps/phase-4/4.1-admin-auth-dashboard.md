# Шаг 4.1: Авторизация и интерфейс менеджера

## Описание
Реализация интерфейса авторизации и dashboard для менеджеров ресторана в admin-web.

## Задачи

### 1. Страница авторизации

#### 1.1. Компонент LoginPage
**Маршрут:** `/login` (публичный, редирект на `/dashboard` если уже авторизован)

**Структура компонента:**
- Контейнер формы авторизации (центрированный)
- Логотип/название системы
- Форма входа
- Ссылка "Забыли пароль?" → переход на страницу восстановления пароля

**Форма входа:**
```typescript
interface LoginForm {
  email: string;        // required, email format
  password: string;     // required, min 8 characters
}
```

**Валидация на фронтенде:**
- **email**: 
  - Обязательное поле
  - Формат email (regex: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`)
  - Сообщение об ошибке: "Введите корректный email"
- **password**:
  - Обязательное поле


**Логика:**
1. При загрузке страницы:
   - Проверить наличие токена в localStorage
   - Если токен есть и валиден → редирект на `/dashboard`
2. При отправке формы:
   - Валидация полей на фронтенде
   - Если валидация не прошла → показать ошибки под полями, НЕ отправлять запрос
   - Если валидация прошла:
     - Показать индикатор загрузки (disabled кнопка, spinner)
     - Отправить POST запрос на `/admin-api/auth/login`:
       ```json
       {
         "email": "manager@example.com",
         "password": "password123"
       }
       ```
3. Обработка ответа:
   - **Успех (200 OK)**:
     - Response: `{ "accessToken": "...", "refreshToken": "...", "role": "ADMIN" | "MANAGER", "expiresIn": 300 }`
     - Сохранить `accessToken` в localStorage (или httpOnly cookie)
     - Сохранить `refreshToken` в localStorage (или httpOnly cookie)
     - Сохранить `role` в localStorage (для отображения элементов UI)
     - Сохранить `expiresIn` и вычислить `tokenExpiry` (текущее время + expiresIn)
     - Отправить GET запрос на `/auth/me` для получения информации о пользователе и подписке
     - Сохранить информацию о подписке в контексте приложения
     - Редирект на `/dashboard`
   - **Ошибка (401 Unauthorized)**:
     - Показать сообщение об ошибке: "Неверный email или пароль"
     - Очистить поля формы (опционально)
   - **Ошибка (400 Bad Request)**:
     - Показать сообщение об ошибке из response body
   - **Ошибка сети (500, timeout)**:
     - Показать сообщение: "Ошибка соединения. Попробуйте позже"

**UI состояния:**
- **Initial**: форма готова к заполнению
- **Loading**: кнопка "Войти" disabled, отображается spinner
- **Error**: под формой отображается сообщение об ошибке (красный текст)
- **Success**: редирект на dashboard

#### 1.2. Хранение токенов
- **accessToken**: localStorage key `admin_access_token`
- **refreshToken**: localStorage key `admin_refresh_token`
- **role**: localStorage key `admin_role` (ADMIN или MANAGER)
- **tokenExpiry**: localStorage key `admin_token_expiry` (timestamp)

**Альтернатива**: Использовать httpOnly cookies (более безопасно, но требует настройки CORS)

### 1.3. Страница восстановления пароля

#### 1.3.1. Компонент ForgotPasswordPage
**Маршрут:** `/forgot-password` (публичный)

**Структура компонента:**
- Контейнер формы (центрированный)
- Логотип/название системы
- Заголовок: "Восстановление пароля"
- Форма запроса кода
- Ссылка "Вернуться к входу" → переход на `/login`

**Форма запроса кода:**
```typescript
interface ForgotPasswordForm {
  email: string;  // required, email format
}
```

**Валидация на фронтенде:**
- **email**: 
  - Обязательное поле
  - Формат email (regex: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`)
  - Сообщение об ошибке: "Введите корректный email"

**Логика:**
1. При отправке формы:
   - Валидация email на фронтенде
   - Если валидация не прошла → показать ошибки под полями, НЕ отправлять запрос
   - Если валидация прошла:
     - Показать индикатор загрузки
     - Отправить POST запрос на `/admin-api/auth/forgot-password`:
       ```json
       {
         "email": "user@example.com"
       }
       ```
2. Обработка ответа:
   - **Успех (200 OK)**: 
     - Показать сообщение: "Код восстановления отправлен на email. Проверьте почту."
     - Редирект на `/reset-password` с email в query параметре (или сохранить email в состоянии)
   - **Ошибка (400 Bad Request)**: 
     - Показать сообщение об ошибке из response body
   - **Ошибка сети (500, timeout)**: 
     - Показать сообщение: "Ошибка соединения. Попробуйте позже"

**UI состояния:**
- **Initial**: форма готова к заполнению
- **Loading**: кнопка "Отправить код" disabled, отображается spinner
- **Error**: под формой отображается сообщение об ошибке
- **Success**: сообщение об успешной отправке и редирект

#### 1.3.2. Компонент ResetPasswordPage
**Маршрут:** `/reset-password` (публичный)

**Структура компонента:**
- Контейнер формы (центрированный)
- Логотип/название системы
- Заголовок: "Восстановление пароля"
- Форма установки нового пароля
- Ссылка "Вернуться к входу" → переход на `/login`

**Форма установки пароля:**
```typescript
interface ResetPasswordForm {
  email: string;        // required, email format
  code: string;         // required, 6 digits
  newPassword: string;  // required, min 8 characters
}
```

**Валидация на фронтенде:**
- **email**: 
  - Обязательное поле
  - Формат email (regex: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`)
  - Сообщение об ошибке: "Введите корректный email"
- **code**: 
  - Обязательное поле
  - Формат: 6 цифр (regex: `/^\d{6}$/`)
  - Сообщение об ошибке: "Код должен состоять из 6 цифр"
- **newPassword**: 
  - Обязательное поле
  - Минимальная длина: 8 символов
  - Сообщение об ошибке: "Пароль должен содержать минимум 8 символов"

**Логика:**
1. При загрузке страницы:
   - Если email передан в query параметре → предзаполнить поле email
   - Если email не передан → показать поле email
2. При отправке формы:
   - Валидация всех полей на фронтенде
   - Если валидация не прошла → показать ошибки под полями, НЕ отправлять запрос
   - Если валидация прошла:
     - Показать индикатор загрузки
     - Отправить POST запрос на `/admin-api/auth/reset-password`:
       ```json
       {
         "email": "user@example.com",
         "code": "123456",
         "newPassword": "newpassword123"
       }
       ```
3. Обработка ответа:
   - **Успех (200 OK)**: 
     - Показать сообщение: "Пароль успешно изменен"
     - Редирект на `/login` через 2 секунды
   - **Ошибка (400 Bad Request)**: 
     - Проверить `exceptionName` в response body:
       - `INVALID_RESET_CODE` → показать сообщение: "Неверный код восстановления"
       - `RESET_CODE_EXPIRED` → показать сообщение: "Код истек. Запросите новый код."
       - `RESET_CODE_ALREADY_USED` → показать сообщение: "Код уже использован. Запросите новый код."
       - `INVALID_PASSWORD` → показать сообщение: "Пароль должен содержать минимум 8 символов"
       - Другие ошибки → показать сообщение из response body
   - **Ошибка (404 Not Found)**: 
     - Показать сообщение: "Пользователь не найден"
   - **Ошибка сети (500, timeout)**: 
     - Показать сообщение: "Ошибка соединения. Попробуйте позже"

**UI состояния:**
- **Initial**: форма готова к заполнению
- **Loading**: кнопка "Изменить пароль" disabled, отображается spinner
- **Error**: под формой или под полями отображаются сообщения об ошибках
- **Success**: сообщение об успехе и редирект на `/login`

### 2. Защита роутов

#### 2.1. Auth Guard / Route Guard
**Логика проверки:**
1. При переходе на защищенный роут:
   - Проверить наличие `accessToken` в localStorage
   - Если токена нет → редирект на `/login`
   - Если токен есть:
     - Проверить срок действия токена (сравнить `tokenExpiry` с текущим временем)
     - Если токен истек:
       - Попытаться обновить токен через `/admin-api/auth/refresh`
       - Если обновление успешно → продолжить
       - Если обновление не удалось → редирект на `/login`
     - Если токен валиден → разрешить доступ

#### 2.2. Автоматическое обновление токена
**Interceptor для HTTP запросов:**
1. Перед каждым запросом:
   - Проверить срок действия токена
   - Если токен истекает в течение 5 минут:
     - Автоматически отправить запрос на `/admin-api/auth/refresh` с `refreshToken`
     - Обновить `accessToken` в localStorage
     - Продолжить исходный запрос с новым токеном
2. При получении 401 Unauthorized:
   - Проверить `exceptionName` в response body:
     - Если `exceptionName === "TOKEN_EXPIRED"`: попытаться обновить токен через refresh
     - Если `exceptionName === "REFRESH_TOKEN_EXPIRED"` или `exceptionName === "INVALID_REFRESH_TOKEN"`: редирект на `/login` (не пытаться refresh)
     - Если `exceptionName === "INVALID_TOKEN"` или `exceptionName === "UNAUTHORIZED"`: редирект на `/login`
   - Если обновление успешно → повторить запрос
   - Если обновление не удалось → редирект на `/login`

**Логика обновления:**
```typescript
async function refreshToken(): Promise<boolean> {
  const refreshToken = localStorage.getItem('admin_refresh_token');
  if (!refreshToken) return false;
  
  try {
    const response = await fetch('/admin-api/auth/refresh', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ refreshToken })
    });
    
    if (response.ok) {
      const data = await response.json();
      localStorage.setItem('admin_access_token', data.accessToken);
      localStorage.setItem('admin_refresh_token', data.refreshToken);
      localStorage.setItem('admin_token_expiry', calculateExpiry(data.expiresIn));
      return true;
    }
    
    // Проверка на истечение refresh token
    const errorData = await response.json().catch(() => null);
    if (errorData?.exceptionName === 'REFRESH_TOKEN_EXPIRED' || 
        errorData?.exceptionName === 'INVALID_REFRESH_TOKEN') {
      // Очистить токены и редирект на логин
      localStorage.removeItem('admin_access_token');
      localStorage.removeItem('admin_refresh_token');
      localStorage.removeItem('admin_token_expiry');
      return false;
    }
    
    return false;
  } catch (error) {
    return false;
  }
}
```

**Обработка ошибок в Interceptor:**
```typescript
// Пример обработки 401 в HTTP interceptor
if (response.status === 401) {
  const errorData = await response.json().catch(() => null);
  const exceptionName = errorData?.exceptionName;
  
  // Если токен истек - попытаться обновить
  if (exceptionName === 'TOKEN_EXPIRED') {
    const refreshed = await refreshToken();
    if (refreshed) {
      // Повторить исходный запрос с новым токеном
      return retryOriginalRequest();
    }
  }
  
  // Для остальных ошибок - редирект на логин
  if (exceptionName === 'REFRESH_TOKEN_EXPIRED' || 
      exceptionName === 'INVALID_REFRESH_TOKEN' ||
      exceptionName === 'INVALID_TOKEN' ||
      exceptionName === 'UNAUTHORIZED') {
    redirectToLogin();
  }
}
```

### 3. Dashboard (главная страница панели управления)

#### 3.1. Компонент DashboardPage
**Маршрут:** `/dashboard` (защищенный)

**Структура страницы:**
- Заголовок: "Панель управления"
- Период для статистики (селектор: сегодня, неделя, месяц, кастомный период)
- Карточки со статистикой (grid layout)
- График бронирований (chart component)
- Список популярных блюд
- Быстрые действия (кнопки для перехода в разделы)

**Карточки статистики:**
1. **Бронирования за период:**
   - Заголовок: "Бронирования"
   - Значение: количество (из API `/admin-api/r/:id/analytics/overview`)
   - Иконка: календарь
   - Тренд: сравнение с предыдущим периодом (↑/↓)
   - Клик → переход на `/bookings`

2. **Предзаказы за период:**
   - Заголовок: "Предзаказы"
   - Значение: количество
   - Иконка: корзина
   - Тренд: сравнение с предыдущим периодом
   - Клик → переход на `/bookings` (с фильтром по предзаказам)

3. **Выручка:**
   - Заголовок: "Выручка"
   - Значение: сумма в тенге (форматированная)
   - Иконка: деньги
   - Тренд: сравнение с предыдущим периодом
   - Клик → переход на `/analytics`

4. **Новые клиенты:**
   - Заголовок: "Новые клиенты"
   - Значение: количество
   - Иконка: пользователи
   - Тренд: сравнение с предыдущим периодом
   - Клик → переход на `/clients`

**График бронирований:**
- Компонент: Chart.js или Recharts
- Тип: Line chart или Bar chart
- Данные: из API `/admin-api/r/:id/analytics/booking?groupBy=day&dateFrom=...&dateTo=...`
- Ось X: даты (последние 7/30 дней)
- Ось Y: количество бронирований
- Легенда: статусы (APPROVED, PENDING, REJECTED, CANCELLED)

**Популярные блюда:**
- Заголовок: "Популярные блюда"
- Список из 5 блюд (из API `/admin-api/r/:id/analytics/pre-order`)
- Для каждого блюда:
  - Название
  - Количество заказов
  - Выручка
  - Иконка/фото блюда (если есть)

**Быстрые действия:**
- Кнопки:
  - "Добавить блюдо" → `/menu/items/new`
  - "Создать акцию" → `/promotions/new`
  - "Управление столами" → `/tables`
  - "Просмотр статистики" → `/analytics`

**Логика загрузки данных:**
1. При загрузке страницы:
   - Показать skeleton loaders для всех карточек
   - Получить ID ресторана из контекста приложения (`currentRestaurant.id`)
   - Для MANAGER: использовать выбранный ресторан из контекста
   - Для ADMIN: использовать выбранный ресторан из списка (или первый по умолчанию)
   - Отправить запрос на `/admin-api/r/:id/analytics/overview?dateFrom=...&dateTo=...`
2. При изменении ресторана (через RestaurantSelector):
   - Перезагрузить все данные dashboard с новым `restaurantId`
3. При получении данных:
   - Заполнить все карточки
   - Построить график
   - Отобразить популярные блюда
4. При ошибке:
   - Показать сообщение об ошибке
   - Кнопка "Повторить запрос"

**Обработка ошибок:**
- 401 Unauthorized → редирект на `/login`
- 403 Forbidden → показать сообщение "Нет доступа к этому ресторану"
- 404 Not Found → показать сообщение "Ресторан не найден"
- 500 Server Error → показать сообщение "Ошибка сервера. Попробуйте позже"

### 4. Навигация

#### 4.1. Компонент Navigation / Sidebar
**Структура:**
- Логотип/название системы (вверху)
- Список пунктов меню
- Информация о пользователе (внизу)
- Кнопка выхода

**Пункты меню (для MANAGER):**
- Dashboard (`/dashboard`)
- Мой ресторан (`/restaurant`)
- Категории меню (`/menu/categories`)
- Меню (`/menu/items`)
- Этажи (`/floors`)
- Залы (`/rooms`)
- Столы (`/tables`)
- Бронирования (`/bookings`) - включает предзаказы блюд
- Подписка (`/subscription`)
- Акции (`/promotions`)
- Аналитика (`/analytics`)
- Клиенты (`/clients`)

**Пункты меню (для ADMIN):**
- Все пункты MANAGER +
- Управление ресторанами (`/admin/restaurants`)
- Управление пользователями (`/admin/users`)
- Системные настройки (`/admin/settings`)

**Логика отображения:**
- Активный пункт меню подсвечивается (background color)
- Для MANAGER: скрыть пункты, недоступные для этой роли
- Иконки для каждого пункта меню

#### 4.2. Компонент RestaurantSelector
**Расположение:** В header справа (перед UserMenu)

**Условия отображения:**
- Виден только для MANAGER
- Отображается только если у менеджера больше одного ресторана
- Если ресторан один → не показывать селектор, показывать только название текущего ресторана (опционально)

**Структура:**
- Dropdown список с названиями ресторанов
- Текущий выбранный ресторан отображается как активный элемент
- При клике открывается список доступных ресторанов

**Логика загрузки данных:**
1. При загрузке приложения (или при логине):
   - Отправить GET запрос на `/admin-api/r` для получения списка ресторанов менеджера
   - Или использовать данные из `/auth/me` (если там есть список ресторанов)
   - Сохранить список ресторанов в контексте/состоянии приложения
2. При первом входе:
   - Если ресторанов несколько → выбрать первый ресторан по умолчанию
   - Сохранить выбранный ресторан в localStorage (key: `admin_selected_restaurant_id`)
   - Если в localStorage уже есть сохраненный ресторан → использовать его

**Логика переключения:**
1. При выборе ресторана из dropdown:
   - Сохранить выбранный `restaurantId` в localStorage (`admin_selected_restaurant_id`)
   - Обновить контекст приложения (текущий ресторан)
   - Обновить все компоненты, которые зависят от текущего ресторана:
     - Dashboard (перезагрузить статистику)
     - Меню, категории, столы и т.д. (если открыты соответствующие страницы)
   - Показать уведомление "Ресторан изменен" (опционально)

**UI состояния:**
- **Loading**: при загрузке списка ресторанов показать skeleton или spinner
- **Error**: при ошибке загрузки показать сообщение "Не удалось загрузить список ресторанов"
- **Success**: отобразить dropdown с названиями ресторанов

**Формат данных:**
```typescript
interface Restaurant {
  id: number;
  name: string;
  address?: string;
  logoImageId?: number;
}

// Контекст приложения
interface AppContext {
  currentRestaurant: Restaurant | null;
  restaurants: Restaurant[];
  setCurrentRestaurant: (restaurant: Restaurant) => void;
}
```

**Пример использования:**
```typescript
// В Header компоненте
{role === 'MANAGER' && restaurants.length > 1 && (
  <RestaurantSelector
    restaurants={restaurants}
    currentRestaurant={currentRestaurant}
    onSelect={handleRestaurantChange}
  />
)}
```

#### 4.3. Компонент UserMenu
**Расположение:** В header справа (после RestaurantSelector)

**Элементы:**
- Email пользователя
- Роль (ADMIN/MANAGER)
- Кнопка "Выход"

**Логика выхода:**
1. При клике на "Выход":
   - Показать подтверждение (опционально)
   - Очистить localStorage (токены, роль, выбранный ресторан)
   - Отправить запрос на `/admin-api/auth/logout` (опционально, для инвалидации токена на сервере)
   - Редирект на `/login`

### 5. Layout компонент

#### 5.1. Компонент AdminLayout
**Структура:**
```
<AdminLayout>
  <Sidebar />           {/* Левая панель навигации */}
  <MainContent>
    <Header />          {/* Верхняя панель с информацией о пользователе */}
    <SubscriptionWarningBanner />  {/* Плашка предупреждения о подписке (только для MANAGER) */}
    <PageContent>       {/* Контент текущей страницы */}
      {children}
    </PageContent>
  </MainContent>
</AdminLayout>
```

**Header компонент:**
- Название текущей страницы
- Breadcrumbs (опционально)
- Селектор ресторанов (справа, только для MANAGER с несколькими ресторанами)
- Уведомления (иконка колокольчика, опционально)
- UserMenu (справа)

**Плашка предупреждения о подписке:**
- Расположение: сразу под Header, на всю ширину экрана
- Условия отображения:
  - Видна только для MANAGER
  - Отображается только если `subscription.isExpiringSoon === true` (осталось ≤ 7 дней)
  - Скрывается, если подписка неактивна или отсутствует
- Стиль:
  - Фон: оранжевый/желтый (предупреждающий цвет)
  - Текст: темный, читаемый
  - Высота: достаточная для текста (примерно 50-60px)
  - Закреплена сверху (sticky), не перекрывает контент
- Содержимое:
  - Иконка предупреждения (опционально)
  - Текст: "Внимание! Подписка истекает через {daysRemaining} {день/дня/дней}. Пожалуйста, продлите подписку."
  - Кнопка "Продлить подписку" (справа) → переход на `/subscription`
- Логика:
  - Данные о подписке загружаются из `/auth/me` при логине
  - При смене ресторана (через RestaurantSelector) → обновить информацию о подписке для нового ресторана
  - При переходе на страницу `/subscription` → плашка может скрываться (опционально)

**Responsive дизайн:**
- На мобильных устройствах: sidebar скрывается, открывается по кнопке (hamburger menu)
- На десктопе: sidebar всегда видимый (или сворачиваемый)

**Логика:**
- Обертка для всех защищенных страниц
- Проверка авторизации через Auth Guard
- Загрузка списка ресторанов при инициализации (для MANAGER)
- Передача контекста (текущий ресторан, список ресторанов, роль пользователя) дочерним компонентам
- Управление состоянием выбранного ресторана (из localStorage или по умолчанию)

**Контекст приложения:**
- Создать React Context для хранения:
  - Текущего ресторана (`currentRestaurant`)
  - Списка доступных ресторанов (`restaurants`)
  - Роли пользователя (`role`)
  - Функции для переключения ресторана (`setCurrentRestaurant`)
  - Информации о подписке (`subscription`) - для текущего ресторана
- Контекст доступен всем дочерним компонентам через `useContext`

### 6. Общие компоненты

#### 6.1. Компонент ImagePreview
**Назначение:** Единый компонент для отображения превью изображений во всех разделах админ-панели.

**Использование:**
- В списках блюд, столов, акций, залов
- В формах редактирования (логотип, фон, фото блюд и т.д.)
- В таблицах и карточках

**Props:**
```typescript
interface ImagePreviewProps {
  imageId: number | null;  // ID изображения
  alt?: string;             // Alt текст для изображения
  className?: string;       // Дополнительные CSS классы
  size?: 'small' | 'medium' | 'large'; // Размер превью (опционально)
  placeholder?: string;     // Текст placeholder (по умолчанию: "Изображение не загружено")
}
```

**Функциональность:**
1. **Отображение превью:**
   - Если `imageId` есть: отобразить превью через `/admin-api/image?id={imageId}&isPreview=true`
   - Если `imageId` нет: показать placeholder с текстом
   - Показывать индикатор загрузки во время загрузки изображения

2. **Клик на превью:**
   - При клике на превью → открыть модальное окно с оригинальным изображением
   - Оригинальное изображение загружается через `/admin-api/image?id={imageId}&isPreview=false`
   - Модальное окно:
     - Полноэкранное или центрированное
     - Кнопка закрытия (X или "Закрыть")
     - Возможность закрыть по клику вне изображения или по ESC
     - Опционально: кнопка "Скачать" для сохранения изображения

3. **Обработка ошибок:**
   - Если изображение не загрузилось → показать placeholder с сообщением об ошибке
   - Логирование ошибки в консоль (для разработки)

**Пример использования:**
```typescript
// В списке блюд
<ImagePreview 
  imageId={item.imageId} 
  alt={item.name}
  size="medium"
  placeholder="Фото не загружено"
/>

// В форме редактирования
<ImagePreview 
  imageId={formData.logoImageId} 
  alt="Логотип ресторана"
  size="large"
/>
```

**Стилизация:**
- Превью: обрезано по размерам контейнера (object-fit: cover)
- Placeholder: серый фон с иконкой изображения и текстом
- Hover эффект: курсор pointer, легкое затемнение (опционально)
- Модальное окно: затемненный фон, изображение по центру с максимальной шириной/высотой

**Компонент модального окна:** ImageModal
- Отдельный компонент для отображения полноразмерного изображения
- Может использоваться независимо от ImagePreview
- Props: `imageId`, `onClose`, `showDownloadButton`

#### 6.2. Компонент ImageUpload
**Назначение:** Единый компонент для загрузки изображений во всех разделах админ-панели.

**Использование:**
- Загрузка логотипа и фона ресторана
- Загрузка фото блюд
- Загрузка фото столов
- Загрузка планов помещений
- Загрузка изображений акций

**Props:**
```typescript
interface ImageUploadProps {
  currentImageId: number | null;  // Текущий imageId (если есть)
  onImageUploaded: (imageId: number) => void;  // Callback при успешной загрузке
  onImageRemoved?: () => void;   // Callback при удалении изображения
  accept?: string;                // Разрешенные форматы (по умолчанию: "image/jpeg,image/png,image/webp")
  maxSize?: number;              // Максимальный размер в байтах (по умолчанию: 5MB)
  type?: string;                 // Тип изображения для API (logo, background, dish, table, room, promotion)
  recommendedSize?: string;      // Рекомендуемые размеры (текст для подсказки)
  aspectRatio?: number;          // Соотношение сторон (опционально, для кропа)
  showCrop?: boolean;            // Показывать ли редактор кропа (опционально)
  className?: string;             // Дополнительные CSS классы
  disabled?: boolean;             // Заблокировать загрузку
}
```

**Функциональность:**
1. **Drag & Drop зона:**
   - Визуальная зона для перетаскивания файлов
   - Highlight при наведении файла
   - Поддержка dragenter, dragover, dragleave, drop событий

2. **Кнопка "Выбрать файл":**
   - Открывает нативный file input
   - Скрытый input с типом `file`
   - При выборе файла → валидация и загрузка

3. **Валидация файлов:**
   - Проверка формата (JPG, PNG, WebP)
   - Проверка размера (максимум 5MB по умолчанию)
   - Показ ошибок валидации под компонентом

4. **Preview изображения:**
   - Использовать компонент `ImagePreview` для отображения текущего изображения
   - Если `currentImageId` есть → показать превью
   - Если `currentImageId` нет → показать placeholder "Выберите изображение"

5. **Загрузка на сервер:**
   - Создать FormData с файлом
   - Отправить POST запрос на `/admin-api/image`:
     ```typescript
     const formData = new FormData();
     formData.append('file', file);
     if (type) formData.append('type', type);
     
     const response = await fetch('/admin-api/image', {
       method: 'POST',
       headers: {
         'Authorization': `Bearer ${token}`
       },
       body: formData
     });
     ```
   - При успехе (201 Created):
     - Получить `imageId` из ответа: `{ imageId: number }`
     - Вызвать `onImageUploaded(imageId)`
     - Обновить preview через `ImagePreview`
   - При ошибке:
     - Показать сообщение об ошибке
     - Логирование ошибки в консоль

6. **Удаление изображения:**
   - Кнопка "Удалить" (если `currentImageId` есть)
   - При клике:
     - Показать подтверждение (опционально)
     - Вызвать `onImageRemoved()` (если передан)
     - Установить `currentImageId = null` в родительском компоненте
     - `ImagePreview` автоматически покажет placeholder

7. **Индикатор загрузки:**
   - Показывать spinner во время загрузки
   - Блокировать взаимодействие во время загрузки

8. **Опциональный кроп изображения:**
   - Если `showCrop === true`:
     - После выбора файла открыть модальное окно с редактором кропа
     - Библиотека: react-image-crop или react-easy-crop
     - Функции: кроп, ресайз, поворот (опционально)
     - Применение кропа:
       - Генерация обрезанного изображения
       - Загрузка обрезанного изображения на сервер
       - Получение `imageId` и вызов `onImageUploaded`

**Пример использования:**
```typescript
// В форме редактирования ресторана
<ImageUpload
  currentImageId={formData.logoImageId}
  onImageUploaded={(imageId) => setFormData({ ...formData, logoImageId: imageId })}
  onImageRemoved={() => setFormData({ ...formData, logoImageId: null })}
  type="logo"
  recommendedSize="200x200px - 500x500px"
  maxSize={5 * 1024 * 1024} // 5MB
/>

// В форме создания блюда
<ImageUpload
  currentImageId={formData.imageId}
  onImageUploaded={(imageId) => setFormData({ ...formData, imageId })}
  onImageRemoved={() => setFormData({ ...formData, imageId: null })}
  type="dish"
  recommendedSize="800x600px - 1200x900px"
  aspectRatio={4/3}
  showCrop={true}
/>
```

**Стилизация:**
- Drag & drop зона: пунктирная рамка, highlight при hover/drag
- Кнопка "Выбрать файл": стилизованная кнопка
- Preview: использует компонент `ImagePreview`
- Индикатор загрузки: spinner overlay
- Ошибки: красный текст под компонентом

**Обработка ошибок:**
- Неверный формат файла → "Разрешены только JPG, PNG, WebP"
- Превышен размер → "Максимальный размер файла: {maxSize}MB"
- Ошибка сети → "Ошибка загрузки. Попробуйте позже"
- Ошибка сервера → показать сообщение из response body

**Информация о подписке:**
- Загружается из `/auth/me` при логине
- Для MANAGER: информация о подписке для текущего ресторана
- Формат данных:
  ```typescript
  interface Subscription {
    restaurantId: number;
    isActive: boolean;
    endDate: string;  // ISO date format
    daysRemaining: number;
    isExpiringSoon: boolean;  // true если daysRemaining <= 7
  }
  ```
- При смене ресторана: обновить информацию о подписке для нового ресторана из массива `restaurants` в контексте
- Если у менеджера несколько ресторанов: информация о подписке берется из массива `restaurants` в `/auth/me` для выбранного ресторана
- При загрузке `/auth/me`: сохранить информацию о подписке для каждого ресторана в контексте

#### 5.2. Компонент SubscriptionWarningBanner
**Расположение:** В AdminLayout, сразу под Header

**Структура:**
- Плашка на всю ширину экрана
- Иконка предупреждения (слева, опционально)
- Текст предупреждения (по центру)
- Кнопка "Продлить подписку" (справа)

**Логика отображения:**
```typescript
// Условие показа плашки
{role === 'MANAGER' && 
 subscription && 
 subscription.isActive && 
 subscription.isExpiringSoon && (
  <SubscriptionWarningBanner
    daysRemaining={subscription.daysRemaining}
    onRenewClick={() => navigate('/subscription')}
  />
)}
```

**Функциональность:**
- Автоматически скрывается, если `subscription.isExpiringSoon === false`
- При клике на "Продлить подписку" → переход на `/subscription`
- При смене ресторана → обновляется информация о подписке для нового ресторана
- Плашка может быть закрыта пользователем (опционально, с сохранением в localStorage)

