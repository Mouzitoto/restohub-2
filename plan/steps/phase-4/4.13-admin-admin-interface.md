# Шаг 4.13: Интерфейс администратора

## Описание
Интерфейс администратора системы для управления всеми ресторанами, пользователями и системными настройками.

## Задачи

### 1. Управление всеми ресторанами

#### 1.1. Компонент AdminRestaurantsPage
**Маршрут:** `/admin/restaurants` (только ADMIN)

**Структура:**
- Заголовок: "Управление ресторанами"
- Поиск по названию
- Фильтр по статусу (активен/неактивен)
- Кнопка "Создать ресторан"
- Таблица ресторанов

**Таблица:**
- Название
- Адрес
- Статус (badge)
- Подписка (активна/неактивна)
- Количество менеджеров
- Действия: "Редактировать", "Удалить", "Назначить менеджера"

**Логика:**
- GET запрос на `/admin-api/r` (список всех ресторанов)
- POST `/admin-api/r` (создание, только ADMIN)
- PUT `/admin-api/r/:id` (редактирование)
- DELETE `/admin-api/r/:id` (удаление, только ADMIN)

#### 1.2. Назначение менеджера ресторану
**Модальное окно:** AssignManagerModal

**Форма:**
- Селектор пользователя (только MANAGER)
- Список доступных менеджеров
- Кнопка "Назначить"

**Логика:**
- POST запрос на `/admin-api/user/:userId/restaurant/:restaurantId` (если есть endpoint)
- Или PUT запрос на `/admin-api/r/:id` с обновлением связи в `users_2_restaurants`

### 2. Управление пользователями

**Примечание:** Детальная реализация управления пользователями описана в [Шаге 4.14: Управление пользователями](4.14-admin-user-management.md).

**Основные компоненты:**
- Компонент AdminUsersPage (`/admin/users`) - страница со списком пользователей
- UserFormModal - форма создания/редактирования пользователя
- ResetPasswordModal - форма сброса пароля
- Функционал активации/деактивации и удаления пользователей

**API endpoints:**
- GET `/admin-api/user` - список пользователей
- POST `/admin-api/user` - создание пользователя
- GET `/admin-api/user/:userId` - получение пользователя
- PUT `/admin-api/user/:userId` - обновление пользователя
- DELETE `/admin-api/user/:userId` - удаление пользователя
- PUT `/admin-api/user/:userId/password` - сброс пароля
- PUT `/admin-api/user/:userId/activate` - активация/деактивация пользователя

### 3. Управление подписками

#### 3.1. Компонент AdminSubscriptionsPage
**Маршрут:** `/admin/subscriptions` (только ADMIN)

**Структура:**
- Заголовок: "Управление подписками"
- Фильтры:
  - По статусу (активна/неактивна)
  - По ресторану
  - По истекающим (expiringSoon)
- Таблица подписок

**Таблица:**
- Ресторан (название)
- Тип подписки
- Период (дата начала - дата окончания)
- Дней осталось
- Статус
- Действия: "Редактировать", "Продлить"

**Логика:**
- GET запрос на `/admin-api/subscription` (список всех подписок)
- PUT `/admin-api/r/:id/subscription` (обновление подписки)

### 4. Системные настройки

#### 4.1. Компонент AdminSettingsPage
**Маршрут:** `/admin/settings` (только ADMIN)

**Структура:**
- Заголовок: "Системные настройки"
- Табы:
  - "Общие настройки"
  - "Интеграции"
  - "Хранилище"
  - "Уведомления"

**Секции:**
1. **Общие настройки:**
   - Название системы
   - Контактная информация
   - Настройки по умолчанию

2. **Интеграции:**
   - WhatsApp бот (номер, токен)
   - Telegram бот (токен, chat ID)
   - Настройки API ключей

3. **Хранилище:**
   - Настройки хранения изображений
   - Максимальный размер файла
   - Разрешенные форматы

4. **Уведомления:**
   - Настройки email уведомлений
   - Шаблоны уведомлений

**Логика:**
- GET `/admin-api/settings` (получение настроек)
- PUT `/admin-api/settings` (обновление настроек)

### 5. Dashboard администратора

#### 5.1. Компонент AdminDashboardPage
**Маршрут:** `/admin/dashboard` (только ADMIN)

**Структура:**
- Заголовок: "Панель администратора"
- Карточки метрик:
  - Количество ресторанов
  - Активных подписок
  - Количество пользователей
  - Новых ресторанов за период
- Графики:
  - Активность ресторанов
  - Статистика подписок

**Логика:**
- Агрегация данных из различных источников
- GET запросы на `/admin-api/r`, `/admin-api/subscription`, `/admin-api/user`

### 6. Права доступа

#### 6.1. Route Guard для ADMIN
**Логика:**
- Проверка роли из localStorage (`admin_role === 'ADMIN'`)
- Если роль не ADMIN → редирект на `/dashboard` или показать 403
- Скрытие пунктов меню для MANAGER

#### 6.2. Скрытие разделов
- В Navigation компоненте:
  - Проверка роли перед отображением пунктов меню
  - Скрыть разделы `/admin/*` для MANAGER

### 7. Интеграция с API
- `GET /admin-api/r` - список всех ресторанов (только ADMIN)
- `POST /admin-api/r` - создание ресторана (только ADMIN)
- `GET /admin-api/user` - список пользователей (только ADMIN)
- `POST /admin-api/user` - создание пользователя (только ADMIN)
- `PUT /admin-api/user/:id` - обновление пользователя (только ADMIN)
- `DELETE /admin-api/user/:id` - удаление пользователя (только ADMIN)
- `GET /admin-api/subscription` - список всех подписок (только ADMIN)
- `GET /admin-api/settings` - системные настройки (только ADMIN)
- `PUT /admin-api/settings` - обновление настроек (только ADMIN)

### 8. Оптимизация индексов
**Примечание**: После реализации фазы 4 необходимо проанализировать запросы к БД и создать/оптимизировать индексы.

- Анализ всех SQL запросов, выполненных в рамках фазы 4 (Admin Web)
- Определение медленных запросов в интерфейсе администратора
- Создание индексов для:
  - Поисковых запросов (поиск ресторанов, пользователей)
  - Фильтрации по ролям (`users.role`)
  - Фильтрации подписок по статусу
- Добавление индексов через миграции Liquibase
- Тестирование производительности запросов с новыми индексами

