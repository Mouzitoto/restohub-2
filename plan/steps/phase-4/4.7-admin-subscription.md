# Шаг 4.7: Подписки

## Описание
Интерфейс для просмотра информации о подписке ресторана.

## Задачи

### 1. Страница информации о подписке

#### 1.1. Компонент SubscriptionPage
**Маршрут:** `/subscription` (защищенный)

**Структура:**
- Заголовок: "Подписка"
- Карточка с информацией о подписке
- Форма редактирования (только для ADMIN)

#### 1.2. Отображение информации о подписке
**Компонент:** SubscriptionInfo

**Отображаемые данные:**
- Тарифный план (`subscriptionType.name`)
- Дата начала подписки (`startDate`)
- Дата окончания подписки (`endDate`)
- Количество дней до окончания (`daysRemaining`)
- Статус (активна/неактивна/просрочена) на основе `isActive` и дат
- Описание (`description`, если есть)

**Визуальная индикация:**
- Цветные индикаторы статуса:
  - Зеленый: активна и не истекает скоро
  - Желтый: активна, но истекает скоро (`isExpiringSoon = true`)
  - Красный: неактивна или просрочена

**Логика загрузки:**
- GET запрос на `/admin-api/r/:id/subscription`
- Отображение данных из ответа API
- Обработка случая, когда подписка не найдена (`isActive = false`)

### 2. Оповещения

#### 2.1. Баннер предупреждения
**Компонент:** SubscriptionWarningBanner (см. шаг 4.1)

**Условия отображения:**
- Если `isExpiringSoon = true` → показать предупреждение о скором окончании
- Если `isActive = false` или подписка просрочена → показать предупреждение о неактивной подписке

**Текст предупреждений:**
- "Подписка истекает через {daysRemaining} дней. Свяжитесь с администратором для продления."
- "Подписка неактивна. Свяжитесь с администратором для активации."

### 3. Для менеджера

#### 3.1. Ограничения доступа
- Только просмотр информации о подписке
- Кнопка "Редактировать" скрыта или неактивна
- Отображение контактной информации для продления подписки

**Логика:**
- Проверка роли пользователя через контекст приложения
- Если роль MANAGER → скрыть форму редактирования

### 4. Для администратора

#### 4.1. Форма редактирования подписки
**Компонент:** SubscriptionFormModal

**Поля формы:**
```typescript
interface SubscriptionForm {
  subscriptionTypeId: number | null;  // optional
  startDate: string | null;            // optional, format: YYYY-MM-DD
  endDate: string | null;              // optional, format: YYYY-MM-DD
  isActive: boolean;                   // optional
  description: string | null;          // optional, max 10000
}
```

**Валидация:**
- `endDate >= startDate` (если указаны обе даты)
- `endDate` должна быть в будущем
- `subscriptionTypeId` должен существовать (если указан)

**Логика:**
1. При открытии формы:
   - Загрузить текущую подписку через GET `/admin-api/r/:id/subscription`
   - Заполнить форму данными подписки
2. При отправке формы:
   - Валидация всех полей
   - Отправить PUT запрос на `/admin-api/r/:id/subscription`
3. Обработка ответа:
   - **Успех (200 OK)**:
     - Закрыть форму
     - Обновить информацию о подписке
     - Показать уведомление "Подписка обновлена"
   - **Ошибка (400 Bad Request)**:
     - Показать ошибки валидации под полями
   - **Ошибка (403 Forbidden)**:
     - Показать сообщение "Нет доступа"
   - **Ошибка (404 Not Found)**:
     - Показать сообщение "Ресторан не найден"

#### 4.2. Управление тарифными планами
**Примечание:** Управление типами подписок (создание, редактирование, удаление) выходит за рамки этого шага. Типы подписок управляются администратором через отдельный интерфейс или напрямую в БД.

**Для выбора типа подписки:**
- Если требуется список типов подписок для выбора, необходимо добавить API endpoint `GET /admin-api/subscription-type` (не реализовано в фазе 3)
- Временное решение: использовать `subscriptionType` из текущей подписки или хардкод списка типов

### 5. Интеграция с API

#### 5.1. Endpoints
- `GET /admin-api/r/:id/subscription` - получение информации о подписке (MANAGER и ADMIN)
- `PUT /admin-api/r/:id/subscription` - обновление подписки (только ADMIN)

#### 5.2. Обработка ошибок
- Стандартизированная обработка всех HTTP статусов
- Отображение понятных сообщений
- Валидация на фронтенде перед отправкой запроса

### 6. Дизайн
- Четкое отображение ключевой информации
- Инструкции по продлению подписки
- Контактная информация для связи (оплата происходит вне системы)
- Визуальная индикация статуса подписки (цветные индикаторы)

## Результаты выполнения шага

По итогу выполнения этого шага должны быть созданы следующие артефакты и выполнены следующие проверки:

### Созданные компоненты:
1. ✅ Страница подписки:
   - Отображение информации о подписке
   - Форма редактирования (для ADMIN)
   - Оповещения о статусе подписки

2. ✅ Интеграция с API:
   - Запросы к `/admin-api/r/:id/subscription`
   - Обработка ответов
   - Обработка ошибок

3. ✅ Контроль доступа:
   - Разделение прав MANAGER и ADMIN
   - Скрытие/показ элементов интерфейса в зависимости от роли

### Функциональные проверки:
1. ✅ Просмотр информации работает:
   - Данные о подписке отображаются корректно
   - Статус подписки определяется правильно
   - Оповещения отображаются при необходимости

2. ✅ Редактирование работает (для ADMIN):
   - Форма открывается и заполняется данными
   - Валидация работает корректно
   - Обновление подписки работает

### Критерии готовности:
- ✅ Все компоненты созданы и работают
- ✅ Интеграция с API работает
- ✅ Контроль доступа работает
- ✅ Все функциональные проверки пройдены успешно

**Шаг считается выполненным**, когда все компоненты работают и все функциональные проверки пройдены успешно.

